# Users-Budgets Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö –±—é–¥–∂–µ—Ç–∞–º–∏ –≤ —Ä–∞–º–∫–∞—Ö —Å–∏—Å—Ç–µ–º—ã Smart Expenses.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

`users-budgets-service` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏: —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞–º–∏: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–≤, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –≤–Ω–µ—à–Ω–µ–º—É JWT (Bearer Token), –ø–∞—Ä–æ–ª–∏ –≤ —Å–µ—Ä–≤–∏—Å–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: REST API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- Java 23
- Spring Boot 3.5.x
- Spring Web (REST API)
- Spring Data JPA (Hibernate)
- Spring Security (OAuth2 Resource Server, JWT)
- PostgreSQL
- Maven
- Lombok

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/main/java/com/smart/expense/usersbudgets/
‚îú‚îÄ‚îÄ config/           # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT Resource Server)
‚îú‚îÄ‚îÄ controller/       # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îú‚îÄ‚îÄ dto/              # DTO-–º–æ–¥–µ–ª–∏ –¥–ª—è API
‚îú‚îÄ‚îÄ entity/           # JPA-—Å—É—â–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ exception/        # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ repository/       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ service/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã

- `entity/User.java`: UUID `id`, `email`, `name`, —Å–≤—è–∑—å `@OneToMany` —Å `Budget`
- `entity/Budget.java`: UUID `id`, `user`, `category`, `amount`, `month`
- `repository/UserRepository.java`: `findById`, `findByEmail`
- `repository/BudgetRepository.java`: `findByUserAndMonth(User user, String month)`
- `service/UserService.java`: CRUD –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π (–ø–∞—Ä–æ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ)
- `service/BudgetService.java`: –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±—é–¥–∂–µ—Ç–∞–º–∏
- `config/SecurityConfig.java`: —Ä–µ—Å—É—Ä—Å-—Å–µ—Ä–≤–µ—Ä JWT, –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç Bearer —Ç–æ–∫–µ–Ω

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–º `auth-service` (–Ω–∞–ø—Ä–∏–º–µ—Ä, Keycloak/Google OAuth2)
- –°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ Bearer JWT —Ç–æ–∫–µ–Ω –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç/–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏: `userId` –≤ URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `sub` (–∏–ª–∏ `preferred_username`) –∏–∑ —Ç–æ–∫–µ–Ω–∞ (`Authentication#getName()`)

## üåê API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Users

- `POST /users` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –¢–µ–ª–æ:
    ```json
    { "name": "John Doe", "email": "john@example.com" }
    ```
  - –û—Ç–≤–µ—Ç 201:
    ```json
    { "id": "uuid", "email": "john@example.com", "name": "John Doe" }
    ```

- `GET /users/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID (—Ç—Ä–µ–±—É–µ—Ç—Å—è Bearer JWT, id –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–æ–∫–µ–Ω–æ–º)

- `GET /users` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è Bearer JWT)

### Budgets

- `POST /budgets/{userId}` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è Bearer JWT; `userId` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞—à–∏–º)
  - –¢–µ–ª–æ:
    ```json
    { "category": "Food", "amount": 300.50, "month": "2025-09" }
    ```

- `GET /budgets/{userId}?month=YYYY-MM` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –±—é–¥–∂–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –º–µ—Å—è—Ü (—Ç—Ä–µ–±—É–µ—Ç—Å—è Bearer JWT)

### Internal

- `GET /internal/budgets-by-user/{userId}?month=YYYY-MM` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è Bearer JWT)

## üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é (Postman)

1) –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é `usersbudgets.postman_collection.json` –≤ Postman.

2) –°–æ–∑–¥–∞–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
- `baseUrl` = `http://localhost:8082`
- `jwtToken` = –≤–∞—à JWT –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ `auth-service`
- `userId` = –≤–∞—à UUID (–∏–∑ —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –∏–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

3) –ü–æ–ª—É—á–µ–Ω–∏–µ JWT:
- JWT –≤—ã–¥–∞–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, Keycloak). –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∫–∞–∫ `Bearer {{jwtToken}}` –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization`.

4) –¢–µ—Å—Ç-–∫–µ–π—Å—ã:
- –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `POST /users` (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
- –°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç: `POST /budgets/{{userId}}`
- –ü–æ–ª—É—á–∏—Ç—å –±—é–¥–∂–µ—Ç—ã –∑–∞ –º–µ—Å—è—Ü: `GET /budgets/{{userId}}?month=2025-09`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–≥–æ `userId` ‚Äî –æ–∂–∏–¥–∞—Ç—å 403/–æ—à–∏–±–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üöÄ –ó–∞–ø—É—Å–∫

```bash
mvn clean compile
mvn spring-boot:run
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `http://localhost:8082`

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

`application.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ JWT `issuer-uri` –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL. –ü–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–µ—Ä–≤–∏—Å–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

